Improved sampling algorithm for mcsolve